<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.13.5/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.13.5"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.13.5/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root, jsonOptions) => {
        const markmap = getMarkmap();
        window.mm = markmap.Markmap.create('svg#mindmap', (getOptions || markmap.deriveOptions)(jsonOptions), root);
      })(() => window.markmap,null,{"type":"heading","depth":0,"payload":{"lines":[0,1]},"content":"MongoDB The Definitive Guide","children":[{"type":"heading","depth":1,"payload":{"lines":[2,3]},"content":"CHAPTER 1 몽고DB 소개","children":[{"type":"heading","depth":2,"payload":{"lines":[4,5]},"content":"1.1 손쉬운 사용","children":[{"type":"list_item","depth":3,"payload":{"lines":[6,7]},"content":"몽고는 도큐먼트의 키와 값을 미리 정의하지 않는다."},{"type":"list_item","depth":3,"payload":{"lines":[7,8]},"content":"고정된 스키마가 없으므로 쉽게 필드를 추가하거나 삭제할 수 있다."}]},{"type":"heading","depth":2,"payload":{"lines":[9,10]},"content":"1.2 확장 가능한 설계","children":[{"type":"list_item","depth":3,"payload":{"lines":[11,12]},"content":"'데이터베이스를 어떻게 확장할 것인가'와 같은 어려운 의사 결정에 직면."},{"type":"list_item","depth":3,"payload":{"lines":[12,13]},"content":"몽고는 분산 확장을 염두에 두고 설계되었다."},{"type":"list_item","depth":3,"payload":{"lines":[13,14]},"content":"데이터를 여러 서버에 더 쉽게 분산하게 해준다."},{"type":"list_item","depth":3,"payload":{"lines":[14,15]},"content":"도큐먼트를 자동으로 재분배하고 사용자 요청을 올바른 장비에 라우팅함으로써 클러스터 내 데이터 양과 부하를 조절할 수 있다."}]},{"type":"heading","depth":2,"payload":{"lines":[16,17]},"content":"1.3 다양한 기능","children":[{"type":"list_item","depth":3,"payload":{"lines":[18,19]},"content":"인덱싱","children":[{"type":"list_item","depth":4,"payload":{"lines":[20,21]},"content":"unique, compound, full-text 인덱싱 기능 제공"},{"type":"list_item","depth":4,"payload":{"lines":[21,22]},"content":"중첩된 도큐먼트(nested document) 및 배열과 같은 계층 구조의 보조 인덱스도 지원함."}]},{"type":"list_item","depth":3,"payload":{"lines":[23,24]},"content":"집계","children":[{"type":"list_item","depth":4,"payload":{"lines":[25,26]},"content":"몽고는 데이터 처리 파이프라인 개념을 기반으로 한 집계 프레임워크를 제공함."},{"type":"list_item","depth":4,"payload":{"lines":[26,27]},"content":"집계 파이프라인(aggregation pipeline)은 데이터베이스 최적화를 최대한 활용하여 서버 측에서 비교적 간단한 일련의 단계로 데이터를 처리하는 것."}]},{"type":"list_item","depth":3,"payload":{"lines":[28,29]},"content":"특수한 컬렉션 유형","children":[{"type":"list_item","depth":4,"payload":{"lines":[29,30]},"content":"몽고는 로그와 같은 최신데이터를 유지하고자 세션이나 고정 크기 컬렉션(capped collection)과 같이 특정 시간에 만료해야 하는 데이터에 대해 유효 시간(time to live - TTL)컬렉션을 지원한다(!!)"},{"type":"list_item","depth":4,"payload":{"lines":[30,31]},"content":"기준 필터(criteria filter)와 일치하는 도큐먼트에 한정된 부분 인덱스(partial index)를 지원하여 효율성을 높이고 저장 공간을 줄인다."}]},{"type":"list_item","depth":3,"payload":{"lines":[31,32]},"content":"파일 스토리지","children":[{"type":"list_item","depth":4,"payload":{"lines":[32,33]},"content":"몽고는 큰 파일의 파일 메타데이터를 저장하는 프로토콜을 지원한다."}]}]},{"type":"heading","depth":2,"payload":{"lines":[34,35]},"content":"1.4 고성능","children":[{"type":"list_item","depth":3,"payload":{"lines":[36,37]},"content":"skip"}]},{"type":"heading","depth":2,"payload":{"lines":[38,39]},"content":"1.5 몽고DB의 철학","children":[{"type":"list_item","depth":3,"payload":{"lines":[40,41]},"content":"결국 몽고는 확장성이 높으며 유연하고 빠른, 즉 완전한 기능을 갖춘 데이터 스토리지를 만드는 일이다."}]}]},{"type":"heading","depth":1,"payload":{"lines":[42,43]},"content":"CHAPTER 2 몽고DB 기본","children":[{"type":"heading","depth":2,"payload":{"lines":[44,45]},"content":"2.0 들어가며","children":[{"type":"list_item","depth":3,"payload":{"lines":[46,47]},"content":"몽고 데이터의 기본 단위는 <em>도큐먼트</em>이다."},{"type":"list_item","depth":3,"payload":{"lines":[47,48]},"content":"<em>컬렉션</em>은 테이블과 유사하다."},{"type":"list_item","depth":3,"payload":{"lines":[48,49]},"content":"몽고의 단일 인스턴스는 자체적인 컬렉션을 갖는 여러 개의 독립적인 <em>데이터베이스</em>를 호스팅한다."},{"type":"list_item","depth":3,"payload":{"lines":[49,50]},"content":"모든 도큐먼트는 컬렉션 내에서 고유한 특수키인 _<em>id</em>를 가진다."},{"type":"list_item","depth":3,"payload":{"lines":[50,51]},"content":"몽고 셸이라는 간단하지만 강력한 도구와 함꼐 배포된다. 자바스크립트 해석기다."}]},{"type":"heading","depth":2,"payload":{"lines":[52,53]},"content":"2.1 도큐먼트","children":[{"type":"list_item","depth":3,"payload":{"lines":[54,55]},"content":"몽고의 핵심은 정렬된 키와 연결된 값의 집합으로 이루어진 <em>도큐먼트</em>다."},{"type":"list_item","depth":3,"payload":{"lines":[55,56]},"content":"해시, 딕셔너리, 맵 등과 같이 표현되는 자료구조를 말한다."},{"type":"list_item","depth":3,"payload":{"lines":[56,57]},"content":"데이터형과 대소문자를 구별한다."},{"type":"list_item","depth":3,"payload":{"lines":[57,58]},"content":"키가 중복될 수 없다."}]},{"type":"heading","depth":2,"payload":{"lines":[59,60]},"content":"2.2 컬렉션"},{"type":"heading","depth":2,"payload":{"lines":[61,62]},"content":"2.2.1 동적 스키마","children":[{"type":"bullet_list","depth":3,"payload":{"lines":[63,69]},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[63,64]},"content":"몽고는 자유롭다. &quot;같은 컬렉션에서도 키, 값, 데이터형 모두 다르게 설정할 수 있는데 왜 굳이 컬렉션이 필요하지?&quot;","children":[{"type":"list_item","depth":5,"payload":{"lines":[64,65],"index":1},"content":"1. 컬렉션 별로 나뉘어져 있으면 개발자와 관리자 모두에게 편하다."},{"type":"list_item","depth":5,"payload":{"lines":[65,66],"index":2},"content":"2. 컬렉션이 분류되어있으면 쿼리로 목록을 뽑을 때 속도가 훨씬 빠르다.(ME:정리 되어있으니까.)"},{"type":"list_item","depth":5,"payload":{"lines":[66,67],"index":3},"content":"3. 데이터 지역성에 좋다."},{"type":"list_item","depth":5,"payload":{"lines":[67,68],"index":4},"content":"4. 인덱스를 정의할 수 있는데 인덱스는 컬렉션 별로 정의한다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[69,70]},"content":"2.2.2 네이밍","children":[{"type":"list_item","depth":4,"payload":{"lines":[71,72]},"content":"컬렉션은 이름으로 식별된다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[72,73]},"content":"빈 문자열은 안된다."},{"type":"list_item","depth":5,"payload":{"lines":[73,74]},"content":"<code>\\0</code>은 사용할 수 없다."},{"type":"list_item","depth":5,"payload":{"lines":[74,75]},"content":"예약어는 사용될 수 없다."},{"type":"list_item","depth":5,"payload":{"lines":[75,76]},"content":"<code>$</code>를 포함할 수 없다."}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[77,78]},"content":"2.3 데이터베이스","children":[{"type":"list_item","depth":3,"payload":{"lines":[79,80]},"content":"몽고는 컬렉션에 도큐먼트를 그룹화할 뿐 아니라 데이터베이스에 컬렉션을 그룹 지어 놓는다."},{"type":"list_item","depth":3,"payload":{"lines":[80,81]},"content":"몽고는 단일 인스턴스에 여러 데이터베이스를 호스팅할 수 있다."},{"type":"list_item","depth":3,"payload":{"lines":[81,82]},"content":"한 앱의 데이터를 동일한 데이터베이스에 저장하는 것은 좋은 방식이다."}]},{"type":"heading","depth":2,"payload":{"lines":[83,84]},"content":"2.4 몽고DB 시작","children":[{"type":"list_item","depth":3,"payload":{"lines":[85,86]},"content":"skip"}]},{"type":"heading","depth":2,"payload":{"lines":[87,88]},"content":"2.5 몽고DB 셸 소개","children":[{"type":"heading","depth":3,"payload":{"lines":[89,90]},"content":"2.5.1 셸 실행","children":[{"type":"list_item","depth":4,"payload":{"lines":[91,92]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[93,94]},"content":"2.5.2 몽고DB 클라이언트","children":[{"type":"list_item","depth":4,"payload":{"lines":[95,96]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[97,98]},"content":"2.5.3 셸 기본 작업","children":[{"type":"list_item","depth":4,"payload":{"lines":[99,100]},"content":"skip"}]}]},{"type":"heading","depth":2,"payload":{"lines":[101,102]},"content":"2.6 데이터형","children":[{"type":"heading","depth":3,"payload":{"lines":[103,104]},"content":"2.6.1 기본 데이터형","children":[{"type":"list_item","depth":4,"payload":{"lines":[105,106]},"content":"몽고는 'JSON'과 닮았다고 생각할 수 있다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[106,107]},"content":"JSON의 한계","children":[{"type":"list_item","depth":6,"payload":{"lines":[107,108]},"content":"기본 데이터 폼이 한정적임. (배열, 객체, 문자열, 숫사, 불리언)"},{"type":"list_item","depth":6,"payload":{"lines":[108,109]},"content":"부동소수점과 정수형을 표현하는 방법이 없고 32비트, 64비트도 구별되지 않음."}]}]},{"type":"list_item","depth":4,"payload":{"lines":[109,110]},"content":"몽고는 JSON의 키/값 쌍 성질을 유지하면서 추가적인 데이터형을 지원한다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[110,111]},"content":"null을 지원한다."},{"type":"list_item","depth":5,"payload":{"lines":[111,112]},"content":"불리언을 지원한다."},{"type":"list_item","depth":5,"payload":{"lines":[112,113]},"content":"숫자를 지원한다."},{"type":"list_item","depth":5,"payload":{"lines":[113,114]},"content":"문자열"},{"type":"list_item","depth":5,"payload":{"lines":[114,115]},"content":"날짜"},{"type":"list_item","depth":5,"payload":{"lines":[115,116]},"content":"정규 표현식"},{"type":"list_item","depth":5,"payload":{"lines":[116,117]},"content":"배열"},{"type":"list_item","depth":5,"payload":{"lines":[117,118]},"content":"내장 도큐먼트"},{"type":"list_item","depth":5,"payload":{"lines":[118,119]},"content":"객체 ID(ObejctId())"},{"type":"list_item","depth":5,"payload":{"lines":[119,120]},"content":"이진 데이터"},{"type":"list_item","depth":5,"payload":{"lines":[120,121]},"content":"코드(ME: 함수를 집어넣을 수 있다..!)"}]}]},{"type":"heading","depth":3,"payload":{"lines":[122,123]},"content":"2.6.2 날짜","children":[{"type":"list_item","depth":4,"payload":{"lines":[124,125]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[126,127]},"content":"2.6.3 배열","children":[{"type":"list_item","depth":4,"payload":{"lines":[128,129]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[130,131]},"content":"2.6.4 내장 도큐먼트","children":[{"type":"list_item","depth":4,"payload":{"lines":[132,133]},"content":"도큐먼트 안에 도큐먼트를 의미한다."},{"type":"list_item","depth":4,"payload":{"lines":[133,134]},"content":"몽고는 내장 도큐먼트를 이해하고, 인덱스를 구성하고, 쿼리하며, 갱신하기 위헤 내장 도큐먼트 내부에 접근한다."},{"type":"list_item","depth":4,"payload":{"lines":[134,135]},"content":"내장 도큐먼트를 분리하지 않으면 내장 도큐먼트를 가지고는있는 도큐먼트들을 모두 수정해야 한다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[135,136]},"content":"ME: 그렇다고 해서 권장하지 않는다 라고는 말할 수 없을 듯.","children":[{"type":"list_item","depth":6,"payload":{"lines":[136,137]},"content":"왜냐하면, 도큐먼트를 모두 1-depth를 유지하게 되면 조인이 불가피하기 때문"}]}]}]},{"type":"heading","depth":3,"payload":{"lines":[138,139]},"content":"2.6.5 _id와 ObjectId","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[140,143]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[140,141]},"content":"<code>_id</code>는 컬렉션 내에서 고유하다."},{"type":"list_item","depth":5,"payload":{"lines":[141,142]},"content":"따라서 각기 다른 두 컬렉션에서 같은 <code>_id</code>가 존재할 수 있다."}]},{"type":"heading","depth":4,"payload":{"lines":[143,144]},"content":"ObjectId","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[145,149]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[145,146]},"content":"ObjectId는 12바이트 스토리지를 사용한다."},{"type":"list_item","depth":6,"payload":{"lines":[146,147]},"content":"24자리 16진수 문자열로 표현이 가능하다."},{"type":"list_item","depth":6,"payload":{"lines":[147,148]},"content":"흔히 거대한 16진수 문자열로 표현되기는 하지만, 실제로 문자열은 저장된 데이터의 두 배만큼 길다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-plaintext\"><code class=\"language-plaintext\">  0 1 2 3 4 5 6 7 8 9 10 11\n  타임스탬프 랜덤       카운터(랜덤 시작 값)\n  ObjectId는 위와 같은 형태로 이루어진다.\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[155,160]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[155,156]},"content":"ObjectId의 첫 4바이트는 타임스탬프이다."},{"type":"list_item","depth":6,"payload":{"lines":[156,157]},"content":"다음 5바이트는 랜덤한 값이다. 최종 3바이트는 서로 다른 시스템의 충돌을 방지한다."},{"type":"list_item","depth":6,"payload":{"lines":[157,158]},"content":"9바이트 이 후부터는 1초 동안 여러 장비와 프로세스를 거쳐 유일성을 보장한다."},{"type":"list_item","depth":6,"payload":{"lines":[158,159]},"content":"고유한 ObjectId는 프로세스당 1초에 <code>1677만 7216개</code>까지 생성된다."}]}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[160,161]},"content":"2.7 몽고DB 셸 사용","children":[{"type":"heading","depth":3,"payload":{"lines":[162,163]},"content":"2.7.1 셸 활용 팁","children":[{"type":"list_item","depth":4,"payload":{"lines":[164,165]},"content":"<code>help</code>를 입력하면 셸의 내장된 도움말을 볼 수 있다."},{"type":"list_item","depth":4,"payload":{"lines":[165,166]},"content":"데이터베이스 수준의 도움말은 <code>db.help()</code>로 알 수 있다."},{"type":"list_item","depth":4,"payload":{"lines":[166,167]},"content":"컬렉션 수준의 도움말은 <code>db.foo.help()</code>로 알 수 있다."},{"type":"list_item","depth":4,"payload":{"lines":[167,168]},"content":"함수의 기능을 알고 싶다면 <code>js</code>처럼 괄호를 없애면 된다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[168,169]},"content":"<code>db.movies.updateOne</code> 입력."},{"type":"list_item","depth":5,"payload":{"lines":[169,170]},"content":"매개변수 순서나 어떻게 동작하는지 알 수 있다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[171,172]},"content":"2.7.2 셸에서 스크립트 실행하기","children":[{"type":"list_item","depth":4,"payload":{"lines":[173,174]},"content":"단순히 명령행에 스크립트만 넘겨서 스크립트를 사용할 수도 있다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[174,175]},"content":"<code>mongo script1.js script2.js</code> 실행."}]},{"type":"list_item","depth":4,"payload":{"lines":[175,176]},"content":"배너 출력을 막고싶으면 <code>--quiet</code> 옵션을 주면 된다."},{"type":"list_item","depth":4,"payload":{"lines":[176,177]},"content":"스크립트는 db 변수에 대한 접근 권한을 가진다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[177,178]},"content":"하지만 usedb나 show collection과 같은 셸 보조자는 파일에서 동작하지 않는다."},{"type":"list_item","depth":5,"payload":{"lines":[178,179]},"content":"셸 보조자의 <code>use video</code>는 JS 스크립트의 <code>db.getSisterDB(&quot;video&quot;)</code>와 같은 의미이다."},{"type":"list_item","depth":5,"payload":{"lines":[179,180]},"content":"셸 보조자의 <code>show dbs</code>는 JS 스크립트의 <code>db.getMongo().getDBS()</code>와 같은 의미이다."},{"type":"list_item","depth":5,"payload":{"lines":[180,181]},"content":"셸 보조자의 <code>show collections</code>는 JS 스크립트의 <code>db.getCollectionNames()</code>와 같은 의미이다."}]},{"type":"list_item","depth":4,"payload":{"lines":[181,182]},"content":"셸에 스크립트를 로드할 수도 있다. <code>load('script1.js')</code>"},{"type":"list_item","depth":4,"payload":{"lines":[182,183]},"content":"기본적으로 셸은 셸을 시작한 디렉터리에서 스크립트를 찾는다."}]},{"type":"heading","depth":3,"payload":{"lines":[184,185]},"content":"2.7.3 .mongorc.js 만들기","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[186,188]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[186,187]},"content":"몽고는 다음과 같이 <code>mongorc.js</code>를 만들 수 있다."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// .mongorc.js</span>\n\n<span class=\"token keyword\">var</span> compliment <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"attractive\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"intelligent\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"like Batman\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> index <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">floor</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ㅎㅇㅎㅇ!\"</span> <span class=\"token operator\">+</span> compliment <span class=\"token operator\">+</span> <span class=\"token string\">\"!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// MongoDB Shell version: 4.2.1</span>\n<span class=\"token comment\">// connecting to: test</span>\n<span class=\"token comment\">// ㅎㅇㅎㅇlike Batman!</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[200,202]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[200,201]},"content":"위 스크립트처럼 <code>js</code>를 활용하여 설정을 할 수도 있다."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">no</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Not on my watch.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// DB 삭제 방지</span>\ndb<span class=\"token punctuation\">.</span><span class=\"token property-access\">dropDatabase</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">DB</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototypedropDatabase</span> <span class=\"token operator\">=</span> no<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 컬렉션 삭제 방지</span>\n<span class=\"token class-name\">DBCollection</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">drop</span> <span class=\"token operator\">=</span> no<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 인덱스 삭제 방지</span>\n<span class=\"token class-name\">DBCollection</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">dropIndex</span> <span class=\"token operator\">=</span> no<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 인덱스 삭제 방지</span>\n<span class=\"token class-name\">DBCollection</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">dropIndexes</span> <span class=\"token operator\">=</span> no<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ME: Database가 실행 된 후 스크립트가 실행되는 것으로 보인다.</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[218,220]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[218,219]},"content":"<code>--norc</code>를 통해 <code>.mongorc.js</code> 로딩을 비활성화 할 수 있다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[220,221]},"content":"2.7.4 프롬프트 커스터마이징하기","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">prompt</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"> \"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[228,230]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[228,229]},"content":"마지막 작업 완료 시각을 얻으려면 위와 같이 작성하면 된다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[230,231]},"content":"2.7.5 복잡한 변수 수정하기","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token constant\">EDITOR</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"/usr/bin/emacs\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 위처럼 emacs를 셸 편집기로 설정할 수 있다.</span>\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[237,238]},"content":"2.7.6 불편한 컬렉션명","children":[{"type":"list_item","depth":4,"payload":{"lines":[239,240]},"content":"skip"}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[241,242]},"content":"CHAPTER 3 도큐먼트 생성, 갱신, 삭제","children":[{"type":"heading","depth":2,"payload":{"lines":[243,244]},"content":"3.1 도큐먼트 삽입","children":[{"type":"heading","depth":3,"payload":{"lines":[245,246]},"content":"3.1.1 insertMany","children":[{"type":"list_item","depth":4,"payload":{"lines":[247,248]},"content":"에러 지점까지는 삽입이 되며, 에러 지점 이후는 삽입이 되지 않는다."}]},{"type":"heading","depth":3,"payload":{"lines":[249,250]},"content":"3.1.2 삽입 유효성 검사","children":[{"type":"list_item","depth":4,"payload":{"lines":[251,252]},"content":"모든 도큐먼트는 <code>16mb</code>보다 작아야 한다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[252,253]},"content":"나쁜 스키마 설계를 예방하고, 일관된 성능을 보장하기 위함."}]},{"type":"list_item","depth":4,"payload":{"lines":[253,254]},"content":"최소한의 검사를 하는 이유는 유효하지 않은 데이터 입력 방지를 위함."},{"type":"list_item","depth":4,"payload":{"lines":[254,255]},"content":"그러므로 App 서버와 같은 신뢰성 있는 소스만 DB에 연결되어야 한다."},{"type":"list_item","depth":4,"payload":{"lines":[255,256]},"content":"대부분 드라이버는 DB에 보내기 전에 유효성 검사를 한다.","children":[{"type":"list_item","depth":5,"payload":{"lines":[256,257],"index":1},"content":"1. 도큐먼트가 너무 크지 않은지"},{"type":"list_item","depth":5,"payload":{"lines":[257,258],"index":2},"content":"2. <code>UTF-8</code>이 아닌 문자열을 사용하는지"},{"type":"list_item","depth":5,"payload":{"lines":[258,259],"index":3},"content":"3. 인식할 수 없는 데이터형을 포함하는지 등 확인한다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[260,261]},"content":"3.1.3 삽입","children":[{"type":"list_item","depth":4,"payload":{"lines":[262,263]},"content":"몽고 3.0 이후 부터는 <code>insert</code> 메써드가 아닌 <code>insertMany</code>와 <code>insertOne</code> 메써드를 사용하자."}]},{"type":"heading","depth":3,"payload":{"lines":[264,265]},"content":"3.2 도큐먼트 삭제","children":[{"type":"list_item","depth":4,"payload":{"lines":[266,267]},"content":"몽고 3.0 이 후 부터는 <code>deleteOne</code>과 <code>deleteMany</code>를 사용하자."}]},{"type":"heading","depth":3,"payload":{"lines":[268,269]},"content":"3.2.1 drop","children":[{"type":"list_item","depth":4,"payload":{"lines":[270,271]},"content":"컬렉션을 삭제하려면 <code>drop</code>을 사용하자."},{"type":"list_item","depth":4,"payload":{"lines":[271,272]},"content":"<code>db.movies.drop()</code>"},{"type":"list_item","depth":4,"payload":{"lines":[272,273]},"content":"이 전에 백업된 데이터를 복원하는 방법 외에 delete 또는 drop 작업을 취소하거나 삭제된 도큐먼트를 복구하는 방법은 없다."}]}]},{"type":"heading","depth":2,"payload":{"lines":[274,275]},"content":"3.3 도큐먼트 갱신","children":[{"type":"bullet_list","depth":3,"payload":{"lines":[276,278]},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[276,277]},"content":"<code>updateOne</code>, <code>updateMany</code>, <code>replaceOne</code>과 같은 갱신 메서드를 사용해 변경한다."}]},{"type":"heading","depth":3,"payload":{"lines":[278,279]},"content":"3.3.1 도큐먼트 치환","children":[{"type":"list_item","depth":4,"payload":{"lines":[280,281]},"content":"<code>replaceOne</code>은 도큐먼트를 새로운 것으로 완전히 치환한다."}]},{"type":"heading","depth":3,"payload":{"lines":[282,283]},"content":"3.3.2 갱신 연산자","children":[{"type":"heading","depth":4,"payload":{"lines":[284,285]},"content":"제한자","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[286,290]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[286,287]},"content":"갱신 연산자는 키를 변경, 추가, 제거한다."},{"type":"list_item","depth":6,"payload":{"lines":[287,288]},"content":"배열과 내장 도큐먼트를 조작하는 복잡한 갱신 연산을 지정하는 데 사용하는 <em>특수키</em>이다."},{"type":"list_item","depth":6,"payload":{"lines":[288,289]},"content":"<em>제한자(modifier)</em>라고 부른다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">users</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lee\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">$inc</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 위는 에러가 출력된다.</span>\n<span class=\"token comment\">// $inc로 증가만 할 수 있도록 제한하였기 때문. 그 외 제한자들은 찾아볼 것.</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[296,301]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[296,297]},"content":"<code>$set</code>는 필드가 존재하지 않으면 새 필드를 생성하는 <em>제한자</em>이다.","children":[{"type":"list_item","depth":7,"payload":{"lines":[297,298]},"content":"키의 데이터 형도 변경할 수 있다."},{"type":"list_item","depth":7,"payload":{"lines":[298,299]},"content":"EXAMPLE: string to array"}]},{"type":"list_item","depth":6,"payload":{"lines":[299,300]},"content":"<code>$unset</code>은 키와 값을 모두 제거한다."}]}]},{"type":"heading","depth":4,"payload":{"lines":[301,302]},"content":"증가와 감소","children":[{"type":"list_item","depth":5,"payload":{"lines":[303,304]},"content":"<code>$inc</code>는 <code>int</code>, <code>long</code>, <code>duble</code>, <code>decimal</code> 타입 값에만 사용할 수 있다.","children":[{"type":"list_item","depth":6,"payload":{"lines":[304,305]},"content":"그 외 데이터형에서는 에러가 출력된다. 위 코드 참조."},{"type":"list_item","depth":6,"payload":{"lines":[305,306]},"content":"<code>$inc</code>의 키 값은 무조건 숫자여야 한다."}]}]},{"type":"heading","depth":4,"payload":{"lines":[307,308]},"content":"요소 추가하기","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[309,313]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[309,310]},"content":"<code>$push</code>는 이미 배열이 존재하면 요소 끝에 추가한다.","children":[{"type":"list_item","depth":7,"payload":{"lines":[310,311]},"content":"배열이 존재하지 않으면 새로운 배열을 생성한다."}]},{"type":"list_item","depth":6,"payload":{"lines":[311,312]},"content":"<code>$each</code>는 <code>$push</code> 한 번에 여러 배열 요소를 추가할 수 있다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">stock</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">ticker</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"G00G\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">$push</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"hourly\"</span> <span class=\"token operator\">:</span> 기\n        <span class=\"token string-property property\">\"$each\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">562.44</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222.44</span><span class=\"token punctuation\">,</span> <span class=\"token number\">123.55</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[325,328]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[325,326]},"content":"`"},{"type":"list_item","depth":6,"payload":{"lines":[326,327]},"content":"<code>$slice</code>는 <code>$push</code>와 결합하여 배열이 특정 크기 이상으로 늘지 않도록 한다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">stock</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">ticker</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">updateOne</span><span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">_id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"G00G\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">$push</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                              <span class=\"token literal-property property\">hourly</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                                        <span class=\"token literal-property property\">$each</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">562.44</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222.44</span><span class=\"token punctuation\">,</span> <span class=\"token number\">123.55</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">$slice</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 배열에 추가할 수 있는 요소의 개수를 10개로 제한.</span>\n                    <span class=\"token comment\">// 10개보다 작으면 유지, 보다 크면 마지막 10개 요소로 유지.</span>\n                    <span class=\"token comment\">// 큐를 만드는 데 용이함.</span>\n          <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]},{"type":"heading","depth":4,"payload":{"lines":[346,347]},"content":"배열을 집합으로 사용하기","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[348,350]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[348,349]},"content":"<code>$ne</code>를 사용하여 배열을 집합처럼 사용할 수 있다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">papers</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">updateOne</span><span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">{</span>\n                    <span class=\"token string-property property\">\"autohrs cites\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                              <span class=\"token literal-property property\">$ne</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Richie\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">$push</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                              <span class=\"token string-property property\">\"authors cited\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Richie\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 인용 목록에 저자가 존재하지 않을 때만 해당 저자를 추가.</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[366,368]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[366,367]},"content":"<code>$addToSet</code>을 사용하여 배열에 존재하지 않는 것들만 추가할 수 있다."}]}]},{"type":"heading","depth":4,"payload":{"lines":[368,369]},"content":"요소 제거하기","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[370,372]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[370,371]},"content":"<code>$pop</code>을 사용하여 요소를 제거할 수 있다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">papers</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">\"autohrs cites\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">$ne</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Richie\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">$pop</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token number\">11</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 배열의 마지막 요소를 제거</span>\n          <span class=\"token comment\">// \"$pop\": {\"key\": -1}은 첫번째 부분 제거</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[383,385]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[383,384]},"content":"<code>$pull</code>은 주어진 조건에 맞는 배열 요소를 모두 제거"}]}]},{"type":"heading","depth":4,"payload":{"lines":[385,386]},"content":"배열의 위치 기반 변경","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[387,389]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[387,388]},"content":"위치 연산자(<code>$</code>)를 사용한다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"comments\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"comment\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"good post\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"votes\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"comment\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pooop\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"votes\"</span><span class=\"token operator\">:</span> <span class=\"token number\">-2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"comment\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"good post\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"max\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"votes\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"comment\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"good post hh\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"alex\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"votes\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[414,417]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[414,415]},"content":"첫 번째 comments를 수정하고자 할 때는 <code>db.blog.updateOne({&quot;post&quot; : post_id}, {&quot;$inc&quot;: {&quot;comments.0.votes&quot;: 1}})</code>를 사용하면 된다."},{"type":"list_item","depth":6,"payload":{"lines":[415,416]},"content":"다음과 같이 사용할 수도 있다. <code>db.blog.updateOne({&quot;comments.author&quot; : &quot;john&quot;}, {&quot;$set&quot;: {&quot;comments.$.author&quot;: &quot;jim&quot;}})</code>"}]}]},{"type":"heading","depth":4,"payload":{"lines":[417,418]},"content":"배열 필터를 이용한 갱신","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[419,421]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[419,420]},"content":"<code>arrayFilters</code>를 이용하여 특정 조건에 맞는 배열 요소를 갱신할 수 있다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">blog</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">updateOne</span><span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">post</span><span class=\"token operator\">:</span> post_id<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">$set</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">\"comments.$[elem].hidden\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">arrayFilters</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token string-property property\">\"elem.votes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">$lte</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">5</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]}]},{"type":"heading","depth":3,"payload":{"lines":[435,436]},"content":"3.3.3 갱신 입력","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[437,441]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[437,438]},"content":"도큐먼트가 존재하면 갱신을, 도큐먼트가 존재하지 않으면 입력을 수행한다."},{"type":"list_item","depth":5,"payload":{"lines":[438,439]},"content":"<code>upsert</code>라고 표현한다.(ME: <code>update</code> + <code>insert</code>)"},{"type":"list_item","depth":5,"payload":{"lines":[439,440]},"content":"세번째 옵션으로 추가할 수 있다."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">anaytics</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">updateone</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/blog\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"$inc\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"$pageviews\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"upsert\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n</code></pre>\n"},{"type":"heading","depth":4,"payload":{"lines":[459,460]},"content":"저장 셸 보조자","children":[{"type":"list_item","depth":5,"payload":{"lines":[461,462]},"content":"<code>save</code>도 갱신 입력을 돕는다."},{"type":"list_item","depth":5,"payload":{"lines":[462,463]},"content":"하나의 파라메터를 받는 함수이다."},{"type":"list_item","depth":5,"payload":{"lines":[463,464]},"content":"<code>_id</code>가 없다면 입력을 수행하며 <code>_id</code>가 있다면 갱신을 수행한다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[465,466]},"content":"3.3.4 다중 도큐먼트 갱신","children":[{"type":"list_item","depth":4,"payload":{"lines":[467,468]},"content":"<code>updateMany</code>는 다중 도큐먼트 갱신 함수이다."},{"type":"list_item","depth":4,"payload":{"lines":[468,469]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[470,471]},"content":"3.3.5 갱신한 도큐먼트 반환","children":[{"type":"list_item","depth":4,"payload":{"lines":[472,473]},"content":"수정된 도큐먼트를 반환하는게 중요한데 다음과 같은 메써드들을 사용하자.","children":[{"type":"list_item","depth":5,"payload":{"lines":[473,474]},"content":"<code>findOneAndDelete</code>"},{"type":"list_item","depth":5,"payload":{"lines":[474,475]},"content":"<code>findOneAndReplace</code>"},{"type":"list_item","depth":5,"payload":{"lines":[475,476]},"content":"<code>findOneUpdate</code>"}]},{"type":"list_item","depth":4,"payload":{"lines":[476,477]},"content":"해당 메써드는<code>mutual exclusion</code> 목적도 가지고 있다."}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[478,479]},"content":"CHAPTER 4 쿼리","children":[{"type":"heading","depth":2,"payload":{"lines":[480,481]},"content":"4.1 find 소개","children":[{"type":"heading","depth":3,"payload":{"lines":[482,483]},"content":"4.1.1 반환받을 키 지정","children":[{"type":"list_item","depth":4,"payload":{"lines":[484,485]},"content":"<code>find</code>의 두번째 매개인자는 반환 받을 키를 지정하는 용도임."},{"type":"list_item","depth":4,"payload":{"lines":[485,486]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[487,488]},"content":"4.1.2 제약 사항","children":[{"type":"list_item","depth":4,"payload":{"lines":[489,490]},"content":"데이터베이스에서 쿼리 도큐먼트 값은 상수여야 한다."},{"type":"list_item","depth":4,"payload":{"lines":[490,491]},"content":"skip"}]}]},{"type":"heading","depth":2,"payload":{"lines":[492,493]},"content":"4.2 쿼리 조건","children":[{"type":"heading","depth":3,"payload":{"lines":[494,495]},"content":"4.2.1 쿼리 조건절","children":[{"type":"list_item","depth":4,"payload":{"lines":[496,497]},"content":"<code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>에 해당하는 비교 연산자는 각각 <code>$lt</code>, <code>$lte</code>, <code>$gt</code>, <code>$gte</code>이다."},{"type":"list_item","depth":4,"payload":{"lines":[497,498]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[499,500]},"content":"4.2.2 OR 쿼리","children":[{"type":"list_item","depth":4,"payload":{"lines":[501,502]},"content":"OR 쿼리는 두 가지 방법이 있다."},{"type":"list_item","depth":4,"payload":{"lines":[502,503]},"content":"<code>$in</code>과 <code>$or</code>이다."},{"type":"list_item","depth":4,"payload":{"lines":[503,504]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[505,506]},"content":"4.2.3 $not","children":[{"type":"list_item","depth":4,"payload":{"lines":[507,508]},"content":"<code>$not</code>은 메타 조건절이며 어떤 조건에도 적용할 수 있다."},{"type":"list_item","depth":4,"payload":{"lines":[508,509]},"content":"skip"}]}]},{"type":"heading","depth":2,"payload":{"lines":[510,511]},"content":"형 특정 쿼리","children":[{"type":"heading","depth":3,"payload":{"lines":[512,513]},"content":"4.3.1 null","children":[{"type":"list_item","depth":4,"payload":{"lines":[514,515]},"content":"ME: <code>js</code>에서 객체에 <code>null</code>을 찾는것과 같음.","children":[{"type":"list_item","depth":5,"payload":{"lines":[515,516]},"content":"예를 들어 <code>null</code>의 <code>falsy</code> 특징"},{"type":"list_item","depth":5,"payload":{"lines":[516,517]},"content":"<code>find</code>로 없는 값을 쿼리하면 null을 가진 키도 검색이 되는 등."}]},{"type":"list_item","depth":4,"payload":{"lines":[517,518]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[519,520]},"content":"4.3.2 정규 표현식","children":[{"type":"list_item","depth":4,"payload":{"lines":[521,522]},"content":"skip"}]},{"type":"heading","depth":3,"payload":{"lines":[523,524]},"content":"4.3.3 배열에 쿼리하기","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">food</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">fruit</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"apple\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"banana\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"peach\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 위 도큐먼트를 다음과 같이 찾을 수 있다.</span>\ndb<span class=\"token punctuation\">.</span><span class=\"token property-access\">food</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">fruit</span><span class=\"token operator\">:</span> <span class=\"token string\">\"banana\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[531,533]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[531,532]},"content":"유효한 도큐먼트는 아니지만 위 <code>db.food.insertOne({ fruit: [&quot;apple&quot;, &quot;banana&quot;, &quot;peach&quot;] });</code> 도큐먼트를 다음과 같다고 가정하자."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"fruit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"apple\"</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"fruit\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"banana\"</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"fruit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"peach\"</span><span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"heading","depth":4,"payload":{"lines":[537,538]},"content":"$all 연산자","children":[{"type":"list_item","depth":5,"payload":{"lines":[538,539]},"content":"배열로 쿼리를 할 수 있도록 도와준다."},{"type":"list_item","depth":5,"payload":{"lines":[539,540]},"content":"예를 들어 <code>['apple', 'banana']</code>로 쿼리를 할 수 있다."}]},{"type":"heading","depth":4,"payload":{"lines":[541,542]},"content":"$size 연산자","children":[{"type":"list_item","depth":5,"payload":{"lines":[542,543]},"content":"크기의 범위로 쿼리할 수 있다."},{"type":"list_item","depth":5,"payload":{"lines":[543,544]},"content":"ref: <a href=\"https://www.mongodb.com/docs/manual/reference/operator/query/size/?_ga=2.7690866.1116110856.1655795628-1824102457.1630638152&amp;_gac=1.120583546.1655795637.Cj0KCQjw2MWVBhCQARIsAIjbwoP5yQGje28mw85qhj5fzBNUYcDZBR_t2-RctN86O8nwMiUcaKPGbF0aAnqSEALw_wcB\">Doc</a>"}]},{"type":"heading","depth":4,"payload":{"lines":[545,546]},"content":"$slice 연산자","children":[{"type":"list_item","depth":5,"payload":{"lines":[546,547]},"content":"배열 요소를 자르는 연산자."},{"type":"list_item","depth":5,"payload":{"lines":[547,548]},"content":"ref: <a href=\"https://www.mongodb.com/docs/manual/reference/operator/update/slice/?_ga=2.206517587.1116110856.1655795628-1824102457.1630638152&amp;_gac=1.191821400.1655795637.Cj0KCQjw2MWVBhCQARIsAIjbwoP5yQGje28mw85qhj5fzBNUYcDZBR_t2-RctN86O8nwMiUcaKPGbF0aAnqSEALw_wcB\">Doc</a>"}]}]},{"type":"heading","depth":3,"payload":{"lines":[549,550]},"content":"4.4 $where 쿼리","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[550,553]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[550,551]},"content":"키/값 쌍만으로 꽤 다양한 쿼리를 할 수 있지만 표현할 수 없는 쿼리도 있다."},{"type":"list_item","depth":5,"payload":{"lines":[551,552]},"content":"이 때 <code>$where</code>절을 사용하여 임의의 자바스크립트를 쿼리의 일부분으로 실행하면 모든 쿼리를 표헌할 수 있다."},{"type":"list_item","depth":5,"payload":{"lines":[552,553]},"content":"다만, 보안상의 이유로 <code>$where</code> 절 사용을 제한해야 한다."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"apple\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"banana\"</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"peach\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"apple\"</span><span class=\"token operator\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"spinach\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"watermelon\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 위 상황에서 spinach와 watermelon이 둘 다 4이기에 $ 조건문을 사용할 수 없다</span>\n<span class=\"token comment\">// $where절로 쿼리를 만들어낼 수 있다.</span>\n\ndb<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"$where\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> current <span class=\"token keyword\">in</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> other <span class=\"token keyword\">in</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>current <span class=\"token operator\">!=</span> other <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span>current<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span>other<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[571,572]},"content":"4.5 커서","children":[{"type":"list_item","depth":4,"payload":{"lines":[572,573]},"content":"데이터베이스는 커서를 사용해 <code>find</code>의 결과를 반환한다."},{"type":"list_item","depth":4,"payload":{"lines":[573,574]},"content":"TODO","children":[{"type":"list_item","depth":5,"payload":{"lines":[574,575]},"content":"ME: 여기만 하면 이제 기본 문법은 끝 !!! 드디어 개발 배움"}]}]}]}]}]},{})</script>
</body>
</html>
