<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.13.3/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.13.3"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.13.3/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root, jsonOptions) => {
        const markmap = getMarkmap();
        window.mm = markmap.Markmap.create('svg#mindmap', (getOptions || markmap.deriveOptions)(jsonOptions), root);
      })(() => window.markmap,null,{"type":"heading","depth":1,"payload":{"lines":[0,1]},"content":"nestJS로 배우는 백엔드 프로그래밍","children":[{"type":"heading","depth":2,"payload":{"lines":[1,2]},"content":"들어가기 전에","children":[{"type":"fence","depth":3,"content":"<pre><code>백엔드를 개발할 때 express로 개발하고 있으나 흔히 백엔드에서 사용되는 DI, AOP, IoC, 테스트 등을 다루지 못하였다. \n백엔드 아키텍쳐에 관련된 개념을 찾아보다가 Spring의 구조가 잘 구조화 되어있다고 느꼈으나 구름의 어플리케이션 전반은 js로 짜여져있으므로 너무 동떨어진 느낌이었다고 느꼈는데 nestJS가 spring js 판이라고 할 수 있을 정도로 유사하며, 잘 짜여진 아키텍쳐 위에서 동작한다고 느껴서 nestJS를 통하여 백엔드 아키텍쳐를 학습해보고자 한다.\n본 서적은 기본 개념부터 알려주므로 이미 알고 있는 개념의 챕터는 무시하며 독서할 것이다. \n</code></pre>\n"}]},{"type":"heading","depth":2,"payload":{"lines":[8,9]},"content":"Hello NestJS","children":[{"type":"heading","depth":3,"payload":{"lines":[9,10]},"content":"Express vs NestJS","children":[{"type":"list_item","depth":5,"payload":{"lines":[10,11]},"content":"Express","children":[{"type":"list_item","depth":7,"payload":{"lines":[11,12]},"content":"가볍게 테스트 서버를 띄울 수 있음."},{"type":"list_item","depth":7,"payload":{"lines":[12,13]},"content":"확장되는 라이브러리를 찾는 데에 코스트가 많이 소비됨"},{"type":"list_item","depth":7,"payload":{"lines":[13,14]},"content":"커뮤니티가 가장 많이 활성화 되어있음."},{"type":"list_item","depth":7,"payload":{"lines":[14,15]},"content":"자유도가 매우 높은 편."}]},{"type":"list_item","depth":5,"payload":{"lines":[15,16]},"content":"NestJS","children":[{"type":"list_item","depth":7,"payload":{"lines":[16,17]},"content":"alemfdnpdj, IoC, CQRS등 이미 많은 기능을 프레임워크 자체에 탑재."},{"type":"list_item","depth":7,"payload":{"lines":[17,18]},"content":"사용자는 문서로부터 대부분의 기능을 구현할 수 있음."},{"type":"list_item","depth":7,"payload":{"lines":[18,19]},"content":"ME: 진입장벽이 높은 편인 듯"}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[20,21]},"content":"NestJS를 배우기 전에","children":[{"type":"heading","depth":3,"payload":{"lines":[21,22]},"content":"웹 프레임워크","children":[{"type":"list_item","depth":5,"payload":{"lines":[22,23]},"content":"웹 개발을 하는데에 필요한 골조 역할"},{"type":"list_item","depth":5,"payload":{"lines":[23,24]},"content":"ME: 그냥 쉽게 웹 + 프레임워크"}]},{"type":"heading","depth":3,"payload":{"lines":[24,25]},"content":"NodeJS","children":[{"type":"list_item","depth":5,"payload":{"lines":[25,26]},"content":"단일 쓰레드에서 구동되는 non-blocking I/O 이벤트 기반 비동기 방식","children":[{"type":"bullet_list","depth":6,"payload":{"lines":[26,28]},"content":"","children":[{"type":"list_item","depth":7,"payload":{"lines":[26,27]},"content":"백그라운드에서는 쓰레드 풀을 구성해서 작업을 처리함."},{"type":"list_item","depth":7,"payload":{"lines":[27,28]},"content":"개발자가 직접 쓰레드 풀을 건드리지는 않고 NodeJS에 탑재된 libuv가 그 역할을 수행함"}]},{"type":"blockquote","depth":6,"payload":{"lines":[28,29]},"content":"","children":[{"type":"paragraph","depth":7,"payload":{"lines":[28,29]},"content":"<b>*libuv</b>: NodeJS에서 사용하는 비동기 IO 라이브러리. C 기반이며 OS 커널을 사용하여 처리할 수 있는 비동기 작업이 있으면 바로 커널로 넘겨버림. 이 후 작업이 종료되어 커널로부터 시스템 콜 받으면 이벤트 루프에 콜백을 등록."}]}]}]},{"type":"heading","depth":3,"payload":{"lines":[29,30]},"content":"이벤트 루프","children":[{"type":"list_item","depth":5,"payload":{"lines":[30,31]},"content":"ME: <b>해당 장은 깊숙히 다룰 필요가 있으므로 지금은 스킵함 2022.03.30</b>"}]},{"type":"heading","depth":3,"payload":{"lines":[31,32]},"content":"패키지 의존성 관리","children":[{"type":"list_item","depth":5,"payload":{"lines":[32,33]},"content":"npm은 Semantic Version Rules을 따른다.","children":[{"type":"list_item","depth":7,"payload":{"lines":[33,34]},"content":"<code>[Major].[Minor].[Patch]-[label]</code> 로 구분된다.","children":[{"type":"list_item","depth":9,"payload":{"lines":[34,35]},"content":"<code>label</code>을 제외한 <code>Major</code>, <code>Minor</code>, <code>Patch</code>는 숫자로 표기된다."},{"type":"list_item","depth":9,"payload":{"lines":[35,36]},"content":"<code>Major</code> : 이전 버전과 호환이 불가능할 때 숫자를 하나 증가시킴.","children":[{"type":"list_item","depth":11,"payload":{"lines":[36,37]},"content":"ME: 예를 들면 osX 카탈리나 -&gt; 몬터레이로 이해 됨."}]},{"type":"list_item","depth":9,"payload":{"lines":[37,38]},"content":"<code>Minor</code>: 기능이 추가되는 경우 숫자가 증가됨. 하위 호환성을 깨트리지 않음."},{"type":"list_item","depth":9,"payload":{"lines":[38,39]},"content":"<code>Patch</code>: 버그 수정 패치"},{"type":"list_item","depth":9,"payload":{"lines":[39,40]},"content":"<code>label</code>: pre, alpha, beta와 같이 부가 설명을 표기함."}]}]},{"type":"list_item","depth":5,"payload":{"lines":[40,41]},"content":"package-json 분석","children":[{"type":"list_item","depth":7,"payload":{"lines":[41,42]},"content":".skip"}]},{"type":"list_item","depth":5,"payload":{"lines":[42,43]},"content":"package.lock","children":[{"type":"list_item","depth":7,"payload":{"lines":[43,44]},"content":".skip"}]}]},{"type":"heading","depth":3,"payload":{"lines":[45,46]},"content":"Typescript","children":[{"type":"list_item","depth":5,"payload":{"lines":[46,47]},"content":".skip"}]},{"type":"heading","depth":3,"payload":{"lines":[48,49]},"content":"Decorator","children":[{"type":"heading","depth":4,"payload":{"lines":[50,51]},"content":"데코레이터","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[51,54]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[51,52]},"content":"실험적 단계이나, 안정적이므로 실제 서비스에서 많이 사용된다."},{"type":"list_item","depth":6,"payload":{"lines":[52,53]},"content":"자바의 어노테이션과 유사(ME: 거의 동일한 듯)"},{"type":"list_item","depth":6,"payload":{"lines":[53,54]},"content":"클래스, 메서드, 접근자, 프로퍼티, 매개변수에 적용 가능하다."}]},{"type":"heading","depth":5,"payload":{"lines":[54,55]},"content":"다음과 같이 적용 가능하다.","children":[{"type":"fence","depth":6,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CreateUserDto</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">IsEmail</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">readonly</span> email<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"type":"heading","depth":5,"payload":{"lines":[61,62]},"content":"데코레이터 작성","children":[{"type":"fence","depth":6,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">deco</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'데코레이터가 평가됨'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> propertyKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> descriptor<span class=\"token operator\">:</span> PropertyDescriptor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TestClass</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">deco</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'HELLO'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'함수 호출됨'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 데코레이터가 평가됨</span>\n<span class=\"token comment\">// HELLO</span>\n<span class=\"token comment\">// 함수 호출됨</span>\n</code></pre>\n"}]},{"type":"heading","depth":5,"payload":{"lines":[81,82]},"content":"데코레이터 합성","children":[{"type":"fence","depth":6,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"first(): factory evaluated\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> propertyKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> descriptor<span class=\"token operator\">:</span> PropertyDescriptor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"first(): called\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">second</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"second(): factory evaluated\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> propertyKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> descriptor<span class=\"token operator\">:</span> PropertyDescriptor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"second(): called\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ExampleClass</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">first</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">second</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">method</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'method is called'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// first(): factory evaluated</span>\n<span class=\"token comment\">// second(): factory evaluated</span>\n<span class=\"token comment\">// second(): called</span>\n<span class=\"token comment\">// first(): called</span>\n<span class=\"token comment\">// method is called</span>\n</code></pre>\n"},{"type":"bullet_list","depth":6,"payload":{"lines":[110,113]},"content":"","children":[{"type":"list_item","depth":7,"payload":{"lines":[110,111]},"content":"first와 second는 평가, return되는 값은 호출이라고 칭한다."},{"type":"list_item","depth":7,"payload":{"lines":[111,112]},"content":"평가는 위에서 아래순으로, 호출은 아래에서 위로 호출되는 것을 알 수 있다."}]}]}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[113,114]},"content":"애플리케이션의 관문 - 인터페이스","children":[{"type":"heading","depth":3,"payload":{"lines":[114,115]},"content":"컨트롤러","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[115,117]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[115,116]},"content":"MVC 패턴에서 말하는 컨트롤러를 말한다."},{"type":"list_item","depth":5,"payload":{"lines":[116,117]},"content":".skip"}]},{"type":"heading","depth":4,"payload":{"lines":[117,118]},"content":"라우팅","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Get <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app.service'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> appService<span class=\"token operator\">:</span> AppService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">getHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>appService<span class=\"token punctuation\">.</span><span class=\"token function\">getHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[132,135]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[132,133]},"content":"위와 같은 구조를 가진다."},{"type":"list_item","depth":6,"payload":{"lines":[133,134]},"content":"데코레이터를 적극 활용함으로써 개발자는 핵심 로직에만 집중할 수 있도록 도와준다."}]}]},{"type":"heading","depth":4,"payload":{"lines":[135,136]},"content":"와일드 카드","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'he*lo'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">getHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>appService<span class=\"token punctuation\">.</span><span class=\"token function\">getHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[142,145]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[142,143]},"content":"위와 같이 <code>*</code>를 사용하여 문자열을 대체할 수 있음."},{"type":"list_item","depth":6,"payload":{"lines":[143,144]},"content":"이건 비단 라우팅 뿐 아니라 컴포넌트에서 이름 정할 때에도 쓰임."}]}]},{"type":"heading","depth":4,"payload":{"lines":[145,146]},"content":"요청 객체","children":[{"type":"list_item","depth":6,"payload":{"lines":[146,147]},"content":"Express처럼 라우터 파라메터에 <code>Req() req:Request</code>와 같이 req에 접근할 수 있다."},{"type":"list_item","depth":6,"payload":{"lines":[147,148]},"content":"ME: 이는 NestJS가 Express 위에서 동작하기 때문에 Express의 기능들을 열어두었기 때문이다."}]},{"type":"heading","depth":4,"payload":{"lines":[149,150]},"content":"응답","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Res</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>usersService<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 위는 Express방식으로 응답해주는 형태이나 NestJS에서는 다음과 같이 응답하길 권장함.</span>\n<span class=\"token comment\">// 우리 구름도 위와 같은 형태.</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HttpCode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">HttpCode</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">202</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Patch</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">':id'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">)</span> id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Body</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> updateUserDto<span class=\"token operator\">:</span> UpdateUserDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>usersService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span>id<span class=\"token punctuation\">,</span> updateUserDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[167,176]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[167,168]},"content":"각 성공 상태 코드","children":[{"type":"list_item","depth":8,"payload":{"lines":[168,169]},"content":"200","children":[{"type":"list_item","depth":10,"payload":{"lines":[169,170]},"content":"서버가 요청을 제대로 처리하였음."}]},{"type":"list_item","depth":8,"payload":{"lines":[170,171]},"content":"201","children":[{"type":"list_item","depth":10,"payload":{"lines":[171,172]},"content":"성공적으로 요청되었으며 새 리소스가 생성됨. 주로 Post로 보낼 때 반환 됨."}]},{"type":"list_item","depth":8,"payload":{"lines":[172,173]},"content":"202","children":[{"type":"list_item","depth":10,"payload":{"lines":[173,174]},"content":"일단 요청은 성공됨. 그런데 아직 처리할 방법이 없거나 처리 중임."},{"type":"list_item","depth":10,"payload":{"lines":[174,175]},"content":"ME: 요청는건 성공하였으나 결과는 서버도 모르니까 보장할 수 없다는 뜻."}]}]}]}]},{"type":"heading","depth":4,"payload":{"lines":[176,177]},"content":"헤더","children":[{"type":"list_item","depth":6,"payload":{"lines":[177,178]},"content":".skip"}]},{"type":"heading","depth":4,"payload":{"lines":[179,180]},"content":"리디렉션","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'redirect/docs'</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Redirect</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://docs.nestjs.com'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">302</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">getDocs</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Query</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">)</span> version<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>version <span class=\"token operator\">&amp;&amp;</span> version <span class=\"token operator\">===</span> <span class=\"token string\">'5'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> url<span class=\"token operator\">:</span> <span class=\"token string\">'https://docs.nestjs.com/v5/'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[189,192]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[189,190]},"content":"<code>http://localhost:3000/redirect/docs?version=5</code> 를 입력하면 <code>https://docs.nestjs.com/v5/</code> 페이지로 이동됨"},{"type":"list_item","depth":6,"payload":{"lines":[190,191]},"content":"<code>302</code>는 상태코드(임시 이동)임."}]}]},{"type":"heading","depth":4,"payload":{"lines":[192,193]},"content":"라우트 파라미터","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Delete</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">':userId/memo/:memoId'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">deleteUserMemo</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> params<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">userId: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>params<span class=\"token punctuation\">.</span>userId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, memoId: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>params<span class=\"token punctuation\">.</span>memoId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[199,201]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[199,200]},"content":"객체 형태로 파라메터를 받는 방법."},{"type":"list_item","depth":6,"payload":{"lines":[200,201]},"content":"권장되지는 않음."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Delete</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">':userId/memo/:memoId'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">deleteUserMemo</span><span class=\"token punctuation\">(</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'userId'</span><span class=\"token punctuation\">)</span> userId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'memoId'</span><span class=\"token punctuation\">)</span> memoId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">userId: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>userId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, memoId: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>memoId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[210,211]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[210,211]},"content":"위와 같이 작성하는 것을 권장함."}]}]},{"type":"heading","depth":4,"payload":{"lines":[211,212]},"content":"하위 도메인 라우팅","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[212,213]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[212,213]},"content":"<code>etc/hosts</code>에서 도메인을 추가한다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span> api<span class=\"token punctuation\">.</span>localhost\n<span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span> v1<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>localhost\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[218,219]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[218,219]},"content":"그리고 Controller에서 하위 도메인을 처리한다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> host<span class=\"token operator\">:</span> <span class=\"token string\">'api.localhost'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// localhost로 변경</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApiController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello, API'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[228,229]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[228,229]},"content":"또한 params를 활용하여 버저닝을 적용할 수도 있다."}]},{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> host<span class=\"token operator\">:</span> <span class=\"token string\">':version.api.localhost'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApiController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">HostParam</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">)</span> version<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello, API </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>version<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"type":"heading","depth":4,"payload":{"lines":[238,239]},"content":"페이로드 다루기","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// createUser.dto.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CreateUserDto</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  email<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// users.controller.ts</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Body</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> createUserDto<span class=\"token operator\">:</span> CreateUserDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">,</span> email <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> createUserDto<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">유저를 생성했습니다. 이름: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, 이메일: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>email<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[253,256]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[253,254]},"content":"DTO는 raw data를 객체화시킬 때 사용 된다."},{"type":"list_item","depth":6,"payload":{"lines":[254,255]},"content":"db에서의 데이터나 클라이언트와 교신 시 데이터 등에서 가공시킬 때 사용된다."}]}]}]},{"type":"heading","depth":3,"payload":{"lines":[256,257]},"content":"유저 서비스의 인터페이스","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[257,258]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[257,258]},"content":"DTD의 쓰임새를 느낄 수 있는 코드는 다음과 같다."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Body<span class=\"token punctuation\">,</span> Controller<span class=\"token punctuation\">,</span> Get<span class=\"token punctuation\">,</span> Param<span class=\"token punctuation\">,</span> Post<span class=\"token punctuation\">,</span> Query <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CreateUserDto <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./dto/create-user.dto'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserLoginDto <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./dto/user-login.dto'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> VerifyEmailDto <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./dto/verify-email.dto'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserInfo <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./UserInfo'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UsersController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Body</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> dto<span class=\"token operator\">:</span> CreateUserDto<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'/email-verify'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">verifyEmail</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Query</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> dto<span class=\"token operator\">:</span> VerifyEmailDto<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'/login'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Body</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> dto<span class=\"token operator\">:</span> UserLoginDto<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:id'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">)</span> userId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserInfo<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[291,292]},"content":"관점 지향 프로그래밍(AOP)","children":[{"type":"list_item","depth":5,"payload":{"lines":[292,293]},"content":"관점 지향 프로그래밍은 횡단 관심사의 분리를 허용함으로써 모듈성을 증가시키는 것이 목적인 프로그래밍 패러다임이다."},{"type":"list_item","depth":5,"payload":{"lines":[293,294]},"content":"ME: 해당 패러다임은 Spring에서 잘 나타나있으므로 Spring 중요한 세 특징으로 찾아봄.","children":[{"type":"list_item","depth":7,"payload":{"lines":[294,295]},"content":"*<b>횡단 관심사(cross-cutting cencern) : </b> 유효성 검사, 로깅, 보안, 트랜잭션과 같이 앱 내 전반에 걸쳐서 제공되는 공통 요소."}]},{"type":"list_item","depth":5,"payload":{"lines":[295,296]},"content":"ME: 이해한 바로는 OOP는 유지하되 횡단 관심사를 모듈화시켜서 공통 모듈로 사용한다는 뜻 같음."}]}]},{"type":"heading","depth":2,"payload":{"lines":[297,298]},"content":"핵심 도메인 로직을 포함하는 프로바이더","children":[{"type":"heading","depth":3,"payload":{"lines":[298,299]},"content":"Provider","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[299,306]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[299,300]},"content":"ME: 컨트롤러는 Goorm의 Router와 같은 역할.","children":[{"type":"list_item","depth":7,"payload":{"lines":[300,301]},"content":"ME: 비즈니스 로직, 데이터 가공 등을 Router로 처리한다면 너무나 복잡해질 것임. 따라서 각각의 역할을 분리시키고 모듈화해야 함. 단일책임원칙에도 더 잘 어울림."},{"type":"list_item","depth":7,"payload":{"lines":[301,302]},"content":"예를 들어서"}]},{"type":"list_item","depth":5,"payload":{"lines":[302,303]},"content":"프로바이더는 서비스(Service), 레포지토리(Repository), 팩토리(Factory), 헬퍼(Helper) 등 여러가지 형태로 구현이 가능.","children":[{"type":"list_item","depth":7,"payload":{"lines":[303,304]},"content":"ME: 각각의 개념은 소프트웨어 아키텍쳐를 다루는 다른 자료를 참고할 것.","children":[{"type":"list_item","depth":9,"payload":{"lines":[304,305]},"content":"TODO: 위 아키텍쳐 자료 조사해보기"}]}]},{"type":"list_item","depth":5,"payload":{"lines":[305,306]},"content":"Nest의 Provider의 핵심은 의존성 주입(DI)임."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 생성자를 이용한 의존성 주입</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BurgerChef</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> BurgerRecipe burgerRecipe<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">BurgerChef</span><span class=\"token punctuation\">(</span>BurgerRecipe burgerRecipe<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>burgerRecipe <span class=\"token operator\">=</span> burgerRecipe<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BurgerRestaurantOwner</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> BurgerChef burgerChef <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BurgerChef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HamburgerRecipe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">changeMenu</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        burgerChef <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BurgerChef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">CheeseBurgerRecipe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 메서드를 이용한 의존성 주입</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BurgerChef</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> BurgerRecipe burgerRecipe <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HamburgerRecipe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setBurgerRecipe</span><span class=\"token punctuation\">(</span>BurgerRecipe burgerRecipe<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>burgerRecipe <span class=\"token operator\">=</span> burgerRecipe<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BurgerRestaurantOwner</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> BurgerChef burgerChef <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BurgerChef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">changeMenu</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        burgerChef<span class=\"token punctuation\">.</span><span class=\"token function\">setBurgerRecipe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">CheeseBurgerRecipe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[342,349]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[342,343]},"content":"<strong><em>의존성 주입(중요함)</em></strong>","children":[{"type":"list_item","depth":7,"payload":{"lines":[343,344]},"content":"ME: 클래스 모델 혹은 코드에는 런타임 시점(인스턴스화 시점)의 의존 관계가 드러나면 안됨.","children":[{"type":"list_item","depth":9,"payload":{"lines":[344,345]},"content":"즉, 인터페이스로 연결되어야 하며, 의존관계는 제 3자가 클래스 모델이 인스턴스화 될 때 주입해주어야 함."}]},{"type":"list_item","depth":7,"payload":{"lines":[345,346]},"content":"의존관계 : 의존대상 B가 변하면, 그것이 A에 영향을 미친다."},{"type":"list_item","depth":7,"payload":{"lines":[346,347]},"content":"클래스 모델이나 코드에는 런타임 시점의 의존관계가 드러나지 않는다. 그러기 위해서는 인터페이스만 의존하고 있어야 한다."},{"type":"list_item","depth":7,"payload":{"lines":[347,348]},"content":"런타임 시점의 의존관계는 컨테이너나 팩토리 같은 제3의 존재가 결정한다."},{"type":"list_item","depth":7,"payload":{"lines":[348,349]},"content":"의존관계는 사용할 오브젝트에 대한 레퍼런스를 외부에서 제공(주입)해줌으로써 만들어진다."}]}]}]},{"type":"heading","depth":3,"payload":{"lines":[349,350]},"content":"프로바이더 등록과 사용","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// cats.service.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Cat <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./interfaces/cat.interface'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CatsService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> cats<span class=\"token operator\">:</span> Cat<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>cat<span class=\"token operator\">:</span> Cat<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cats<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>cat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Cat<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cats<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// cats.controller.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Get<span class=\"token punctuation\">,</span> Post<span class=\"token punctuation\">,</span> Body <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CreateCatDto <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./dto/create-cat.dto'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CatsService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./cats.service'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Cat <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./interfaces/cat.interface'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'cats'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CatsController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> catsService<span class=\"token operator\">:</span> CatsService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Body</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> createCatDto<span class=\"token operator\">:</span> CreateCatDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>catsService<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>createCatDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Cat<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>catsService<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[390,391]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[390,391]},"content":"위처럼 <code>@injectable</code>로 클래스를 감싸주면 의존성을 주입할 수 있다는 것을 nestJS에게 알려주게 된다."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 속성 기반 주입</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServiceB</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _serviceA<span class=\"token operator\">:</span> ServiceA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>_serviceA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">getHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">doSomeFuncFromA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 속성 기반 주입 using @Inject</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span>ServiceA<span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> serviceA<span class=\"token operator\">:</span> ServiceA<span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span>\n\n    <span class=\"token function\">doSomeFuncFromA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceA<span class=\"token punctuation\">.</span><span class=\"token function\">getHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[415,417]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[415,416]},"content":"ME: 위 코드들을 보면 신기한 점이 있음. services를 인스턴스화 시키지 않았음에도 사용될 수 있는건 nest가 <code>@injectable</code>를 module에서 <code>provider</code>로 지정했을 때 의존성 주입과 함께 인스턴스화 시키는 거로 보임.(추측)"}]}]},{"type":"heading","depth":3,"payload":{"lines":[417,418]},"content":"스코프","children":[{"type":"list_item","depth":5,"payload":{"lines":[419,420]},"content":"<strong><em><em>멀티 테넌시</em></em></strong>","children":[{"type":"list_item","depth":7,"payload":{"lines":[420,421]},"content":"하나의 인스턴스가 여러 사용자에게 각각 다르게 동작하도록 하는 SW 아키텍쳐."},{"type":"list_item","depth":7,"payload":{"lines":[421,422]},"content":"반대로 각 사용자마자 인스턴스가 새로 만들어지는 것은 <strong><em><em>멀티 인스턴스</em></em></strong> 방식"}]},{"type":"list_item","depth":5,"payload":{"lines":[422,423]},"content":"DEFAULT: 싱글톤 인스턴스가 전체 어플리케이션에서 공유 됨. 인스턴스 수명 === 어플리케이션면수명, 부트 스트랩(시스템이 구동 되는 것) 과정을 마치면 모든 싱글톤 프로바이더의 인스턴스가 만들어짐."},{"type":"list_item","depth":5,"payload":{"lines":[423,424]},"content":"REQUEST: 들어오는 요청마다 별도의 인스턴스가 생성됨. 요청을 처리하고 나면 쓰레기 수집 됨."},{"type":"list_item","depth":5,"payload":{"lines":[424,425]},"content":"TRANSIENT: 임시 프로바이더를 주입하는 각 컴포넌트는 새로 생성된 전용 인스턴스를 주입받게 됨."},{"type":"list_item","depth":5,"payload":{"lines":[425,426]},"content":"Provider, Controller에 각각의 Scope를 지정할 수 있음."},{"type":"list_item","depth":5,"payload":{"lines":[426,427]},"content":"Controller -&gt; Service -&gt; Repository 와 같은 종속성 그래프에서 Service가 REQUEST이고 나머지는 DEFAULT일 때, Controller는 Service를 의존하므로 REQUEST가 됨. 그렇지만 Repository는 의존하지 않으므로 DEFAULT."}]},{"type":"heading","depth":3,"payload":{"lines":[428,429]},"content":"커스텀 프로바이더","children":[{"type":"heading","depth":4,"payload":{"lines":[429,430]},"content":"Value Provider","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 모의 객체 선언</span>\n<span class=\"token keyword\">const</span> mockCatsService <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">/* 테스트에 적용할 값을 변경한다\n...\n*/</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\nimports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>CatsModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\nproviders<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    provide<span class=\"token operator\">:</span> CatsService<span class=\"token punctuation\">,</span>\n    useValue<span class=\"token operator\">:</span> mockCatsService<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[449,451]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[449,450]},"content":"<code>Provider</code>는 <code>CatsService</code>를 지정하지만, 실제 값은 <code>mockCatsService</code>를 사용하겠다는 것."},{"type":"list_item","depth":6,"payload":{"lines":[450,451]},"content":"ME: <code>absctract class</code>를 <code>provide</code>로 지정하고 사용 될 <code>class</code>를 <code>useValue</code>로 사용하면 좀 더 결합성이 많이 느슨해질지도?"}]}]},{"type":"heading","depth":4,"payload":{"lines":[451,452]},"content":"Class Provider","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[452,453]},"content":""},{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> configServiceProvider <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  provide<span class=\"token operator\">:</span> ConfigService<span class=\"token punctuation\">,</span>\n  useClass<span class=\"token operator\">:</span>\n    process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'development'</span>\n      <span class=\"token operator\">?</span> DevelopmentConfigService\n      <span class=\"token operator\">:</span> ProductionConfigService<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>configServiceProvider<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[467,470]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[467,468]},"content":"위처럼 <code>ConfigService</code>를 사용(참조?)하면서 실제 클래스는 <code>useClass</code>로 지정해줌."},{"type":"list_item","depth":6,"payload":{"lines":[468,469]},"content":"ME: 노드 환경을 dev, prov, def 등등을 지정해줄 때 용이할 듯."},{"type":"list_item","depth":6,"payload":{"lines":[469,470]},"content":"ME: 혹은 추상화 시킬 때도 좋을 것 같음."}]}]},{"type":"heading","depth":4,"payload":{"lines":[470,471]},"content":"Factory Provider","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  provide<span class=\"token operator\">:</span> <span class=\"token string\">'CONNECTION'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>optionsProvider<span class=\"token operator\">:</span> OptionsProvider<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> optionsProvider<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DatabaseConnection</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>OptionsProvider<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>connectionFactory<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[486,488]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[486,487]},"content":"<strong><em>함수 실행 과정 중 다른 provider가 필요하다면</em></strong> 주입받아 사용할 수 있음."}]}]},{"type":"heading","depth":4,"payload":{"lines":[488,489]},"content":"Alias provider","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> loggerAliasProvider <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  provide<span class=\"token operator\">:</span> <span class=\"token string\">'AliasedLoggerService'</span><span class=\"token punctuation\">,</span>\n  useExisting<span class=\"token operator\">:</span> LoggerService<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>LoggerService<span class=\"token punctuation\">,</span> loggerAliasProvider<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token comment\">//----------------------------------------------------</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'AliasedLoggerService'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> serviceAlias<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'/alias'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">getHelloAlias</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceAlias<span class=\"token punctuation\">.</span><span class=\"token function\">getHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[514,515]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[514,515]},"content":"위처럼 다른 이름으로 별칭을 목적으로 사용될 수 있음."}]}]},{"type":"heading","depth":4,"payload":{"lines":[515,516]},"content":"export","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  provide<span class=\"token operator\">:</span> <span class=\"token string\">'CONNECTION'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>optionsProvider<span class=\"token operator\">:</span> OptionsProvider<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> optionsProvider<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DatabaseConnection</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>OptionsProvider<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>connectionFactory<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  exports<span class=\"token operator\">:</span> connectionFactory<span class=\"token punctuation\">,</span> <span class=\"token comment\">/* or ['CONNECTION'] */</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[532,534]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[532,533]},"content":"다른 모듈을 사용하려면 해당 모듈에서 <code>export</code>를 해주어야 함. 이는 토큰으로 내보낼 수도 있음."}]}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[534,535]},"content":"SW복잡도를 낮추기 위한 모듈 설계","children":[{"type":"heading","depth":3,"payload":{"lines":[535,536]},"content":"모듈 - 응집성 있는 설계","children":[{"type":"heading","depth":4,"payload":{"lines":[536,537]},"content":"모듈 다시 내보내기","children":[{"type":"list_item","depth":6,"payload":{"lines":[537,538]},"content":"imports, exports로만 만들어진 모듈로 디펜던시 트리를 잘 정립할 수 있다."}]},{"type":"heading","depth":4,"payload":{"lines":[538,539]},"content":"전역 모듈","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Global</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>CommonService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  exports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>CommonService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CommonModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[547,548]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[547,548]},"content":"헬퍼나 DB 연결 같은 전역적으로 사용 될 모듈은 Global로 지정할 수 있다."}]}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[548,549]},"content":"동적 모듈을 활용한 환경변수 구성","children":[{"type":"heading","depth":3,"payload":{"lines":[549,550]},"content":"동적 모듈","children":[{"type":"list_item","depth":5,"payload":{"lines":[550,551]},"content":"모듈을 인스턴스화 할 때 값을 다르게하여 동적으로 인스턴스화 해줌"},{"type":"list_item","depth":5,"payload":{"lines":[551,552]},"content":"대표적으로 Config가 있음."}]},{"type":"heading","depth":3,"payload":{"lines":[552,553]},"content":"dotenv를 이용한 Config 설정","children":[{"type":"list_item","depth":5,"payload":{"lines":[553,554]},"content":"ME: Keep."}]},{"type":"heading","depth":3,"payload":{"lines":[554,555]},"content":"Nest에서 제공하는 Config 패키지","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/config'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[565,566]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[565,566]},"content":"<code>forRoot()</code> 함수는 동적 모듈을 리턴하는 정적 메서드."}]}]},{"type":"heading","depth":3,"payload":{"lines":[566,567]},"content":"유저서비스에 환경변수 구성하기","children":[{"type":"list_item","depth":5,"payload":{"lines":[567,568]},"content":"<code>joi</code> 라이브러리 - 환경변수 유효성 검사에 사용 됨","children":[{"type":"list_item","depth":7,"payload":{"lines":[568,569]},"content":"ME: 주로 외부 모듈 이야기로 구성 되어있으므로 스킵"}]}]},{"type":"heading","depth":3,"payload":{"lines":[569,570]},"content":"IoC와 DI","children":[{"type":"heading","depth":4,"payload":{"lines":[570,571]},"content":"IoC ?","children":[{"type":"bullet_list","depth":5,"payload":{"lines":[571,572]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[571,572]},"content":"제어의 역전"}]},{"type":"fence","depth":5,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UsersController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> usersService<span class=\"token operator\">:</span> UsersService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":5,"payload":{"lines":[578,580]},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[578,579]},"content":"컨트롤러가 <code>UserService</code>를 사용하고 있지만 라이프 사이클에는 전혀 관여하지 않는다."},{"type":"list_item","depth":6,"payload":{"lines":[579,580]},"content":"내부 구조를 모르며 그저 가져다 쓸 뿐이다. 이 역할이 <code>IoC</code>라고 한다."}]}]},{"type":"heading","depth":4,"payload":{"lines":[580,581]},"content":"DI ?","children":[{"type":"list_item","depth":6,"payload":{"lines":[581,582]},"content":"의존성 주입"},{"type":"list_item","depth":6,"payload":{"lines":[582,583]},"content":"의존성을 IoC 컨테이너가 주입해준다."},{"type":"list_item","depth":6,"payload":{"lines":[583,584]},"content":"자세히 말하면 IoC 컨테이너가 직접 객체의 생명주기를 관리해주는 방식."}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[585,586]},"content":"파이프와 유효성 검사 - 요청이 제대로 전달되었는가","children":[{"type":"heading","depth":3,"payload":{"lines":[586,587]},"content":"파이프","children":[{"type":"list_item","depth":5,"payload":{"lines":[587,588]},"content":"파이프는 미들웨어와 유사함."},{"type":"list_item","depth":5,"payload":{"lines":[588,589]},"content":"미들웨어와의 차이점은 순서."},{"type":"list_item","depth":5,"payload":{"lines":[589,590]},"content":"다음과 같은 두가지 목적으로 사용됨.","children":[{"type":"list_item","depth":7,"payload":{"lines":[590,592]},"content":"","children":[{"type":"ordered_list","depth":8,"payload":{"lines":[590,591],"startIndex":1},"content":"","children":[{"type":"list_item","depth":9,"payload":{"lines":[590,591],"index":1},"content":"1. 변환: 입력데이터를 원하는 형식으로 변환"}]},{"type":"bullet_list","depth":8,"payload":{"lines":[591,592]},"content":"","children":[{"type":"list_item","depth":9,"payload":{"lines":[591,592]},"content":"<code>/users/user/1</code> 내의 경로 파라메터 문자열 <code>1</code>을 숫자로환변환"}]}]},{"type":"list_item","depth":7,"payload":{"lines":[592,593]},"content":"","children":[{"type":"list_item","depth":9,"payload":{"lines":[592,593],"index":2},"content":"2. 유효성 검사: 입력데이터가 사용자가 정한 기준에 유효하지 않은 경우 예외 처리"}]}]},{"type":"list_item","depth":5,"payload":{"lines":[593,594]},"content":"<code>@nest/common</code>에는 다음과 같은 내장 파이프가 마련되어있음.","children":[{"type":"list_item","depth":7,"payload":{"lines":[594,595]},"content":"ValidationPipe"},{"type":"list_item","depth":7,"payload":{"lines":[595,596]},"content":"ParseIntPipe"},{"type":"list_item","depth":7,"payload":{"lines":[596,597]},"content":"ParseBoolPipe"},{"type":"list_item","depth":7,"payload":{"lines":[597,598]},"content":"ParseArrayPipe"},{"type":"list_item","depth":7,"payload":{"lines":[598,599]},"content":"ParseUUIDPipe"},{"type":"list_item","depth":7,"payload":{"lines":[599,600]},"content":"DefaultValuePipe"}]},{"type":"list_item","depth":5,"payload":{"lines":[600,601]},"content":"ME: <code>express</code>를 사용하면서 <code>middleware</code>의 순서에 대해 궁금한 점이 많았는데 이를 nest가 해소한 듯 하다. <code>pipe</code> 외에 <code>guard</code>, <code>gateway</code> 등 사실 모두 <code>express</code>의 <code>middleware</code>와 다를 바 없지만 순서라는 약속을 한 것 뿐으로 보인다."}]},{"type":"heading","depth":3,"payload":{"lines":[601,602]},"content":"파이프의 내부 구현 이해하기","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[602,603]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[602,603]},"content":"PipeTransform을 상속받아서 정의해주면 된다."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PipeTransform<span class=\"token punctuation\">,</span> Injectable<span class=\"token punctuation\">,</span> ArgumentMetadata <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ValidationPipe</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">PipeTransform</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">transform</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> metadata<span class=\"token operator\">:</span> ArgumentMetadata<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>metadata<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]},{"type":"heading","depth":2,"payload":{"lines":[614,615]},"content":"영속화 - 데이터를 기록하고 다루기"},{"type":"heading","depth":2,"payload":{"lines":[615,616]},"content":"요청과 응답을 입맛에 맞게 바꾸는 미들웨어","children":[{"type":"heading","depth":3,"payload":{"lines":[616,617]},"content":"미들웨어","children":[{"type":"list_item","depth":5,"payload":{"lines":[617,618]},"content":"쿠키를 파싱할 때 사용될 수 있음."},{"type":"list_item","depth":5,"payload":{"lines":[618,619]},"content":"인증/인가 가능. 다만 Guard 사용 권장."},{"type":"list_item","depth":5,"payload":{"lines":[619,620]},"content":"ME: Guard, Pipe, Interceptor도 다 미들웨어."}]},{"type":"heading","depth":3,"payload":{"lines":[620,621]},"content":"Logger 미들웨어","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable<span class=\"token punctuation\">,</span> NestMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request<span class=\"token punctuation\">,</span> Response<span class=\"token punctuation\">,</span> NextFunction <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoggerMiddleware</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestMiddleware</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> NextFunction<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Request...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ----------</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MiddlewareConsumer<span class=\"token punctuation\">,</span> Module<span class=\"token punctuation\">,</span> NestModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> LoggerMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./logger/logger.middleware'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UsersModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./users/users.module'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>UsersModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestModule</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>consumer<span class=\"token operator\">:</span> MiddlewareConsumer<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">consumer</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>LoggerMiddleware<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[648,649]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[648,649]},"content":"위 코드로 /users에 들어오면 <code>Reqeust...</code>가 찍히게 된다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[649,650]},"content":"MiddlewrareConsumer","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestModule</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>consumer<span class=\"token operator\">:</span> MiddlewareConsumer<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">consumer</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>LoggerMiddleware<span class=\"token punctuation\">,</span> Logger2Middleware<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">exclude</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token operator\">:</span> <span class=\"token string\">'users'</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> RequestMethod<span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span>UsersController<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[661,662]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[661,662]},"content":"<code>exclude</code>는 제외로 지정된 paths는 제외됩니다."}]}]},{"type":"heading","depth":3,"payload":{"lines":[662,663]},"content":"전역으로 적용하기"}]},{"type":"heading","depth":2,"payload":{"lines":[663,664]},"content":"권한 확인을 위한 가드 - JWT 인증/인가","children":[{"type":"bullet_list","depth":3,"payload":{"lines":[664,666]},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[664,665]},"content":"가드는 다음 실행 컨텍스트를 알 수 있음."},{"type":"list_item","depth":4,"payload":{"lines":[665,666]},"content":"또한 전역에서 사용하려면 부트스트랩 단에서 적용시켜주어야 함."}]},{"type":"heading","depth":3,"payload":{"lines":[666,667]},"content":"가드(Guard)","children":[{"type":"list_item","depth":5,"payload":{"lines":[667,668]},"content":"올바른 유저인지 검증하는 수단."},{"type":"list_item","depth":5,"payload":{"lines":[668,669]},"content":"미들웨어는 단순히 자신의 일만 수행하고 next() 호출하므로 올바르지 못함."}]},{"type":"heading","depth":3,"payload":{"lines":[669,670]},"content":"가드를 이용한 인가"},{"type":"heading","depth":3,"payload":{"lines":[670,671]},"content":"인증","children":[{"type":"list_item","depth":5,"payload":{"lines":[671,672]},"content":"대표적으로 세션과 JWT 인증 방식이 있다."},{"type":"list_item","depth":5,"payload":{"lines":[672,673]},"content":"나머진 생략."}]}]},{"type":"heading","depth":2,"payload":{"lines":[674,675]},"content":"로깅","children":[{"type":"heading","depth":3,"payload":{"lines":[675,676]},"content":"내장 로거","children":[{"type":"bullet_list","depth":4,"payload":{"lines":[676,677]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[676,677]},"content":"로그에는 레벨이 있음."}]},{"type":"fence","depth":4,"content":"<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">LOG_LEVEL_VALUES</span><span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span>LogLevel<span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  debug<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  verbose<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  log<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  warn<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  error<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"type":"bullet_list","depth":4,"payload":{"lines":[686,687]},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[686,687]},"content":"로 정의할 수 있음."}]}]},{"type":"heading","depth":3,"payload":{"lines":[687,688]},"content":"커스텀 로거","children":[{"type":"list_item","depth":5,"payload":{"lines":[688,689]},"content":"로거를 검색에 용이하게 만들기 위해서 커스텀 로거가 필요함."},{"type":"list_item","depth":5,"payload":{"lines":[689,690]},"content":"그렇지만 데이터베이스 저장, 에러 메일 전송도 필요하므로 외부 로거를 사용하는 예제를 참고하겠음."},{"type":"list_item","depth":5,"payload":{"lines":[690,691]},"content":"<code>winston</code>"}]}]}]},{})</script>
</body>
</html>
